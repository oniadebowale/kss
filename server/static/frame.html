<html>
<head>
<link rel="stylesheet"
  href="http://twitter.github.com/bootstrap/1.3.0/bootstrap.min.css">
<script type="text/javascript"
  src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js">
</script>
<script type="text/javascript"
  src="http://twitter.github.com/bootstrap/1.3.0/bootstrap-modal.js">
</script>
<script type="text/javascript">

var EXTENSION_URL = 'chrome-extension://nkedodhlapopoagdecodhheoncmpbnin';

// Function partially ripped from http://openid-demo.appspot.com
function openPopupWindow(openid) {
  window.open('http://yuze.no-ip.org:8081/auth?openid_identifier='
          + encodeURIComponent(openid), 'openid_popup',
          'width=450,height=500,location=1,status=1,resizable=true');
}

function handleOpenIDResponse(openid_args) {
  $.get('http://yuze.no-ip.org:8081/verify?' + openid_args, function(d,t,j) {
    top.postMessage(JSON.stringify(d), EXTENSION_URL);
  }, 'json');
}

window.addEventListener('message', function(event) {
  if (event.origin !== EXTENSION_URL) return;

  // Message from chrome extension will always be in JSON format
  var d = JSON.parse(event.data);
  if (d.method == 'openid_auth') {
    openPopupWindow(d.data);
  }
}, false);

top.postMessage('{"error": 1}', EXTENSION_URL);
</script>
</head>
<body></body>
</html>
